<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="pastclim">
<title>pastclim overview • pastclim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="pastclim overview">
<meta property="og:description" content="pastclim">
<meta property="og:image" content="https://evolecolgroup.github.io/pastclim/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">pastclim</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/available_datasets.html">available datasets</a>
    <a class="dropdown-item" href="../articles/custom_datasets.html">custom dataset</a>
    <a class="dropdown-item" href="../articles/pastclim_overview.html">pastclim overview</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/EvolEcolGroup/pastclim/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>pastclim overview</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EvolEcolGroup/pastclim/blob/HEAD/vignettes/pastclim_overview.Rmd" class="external-link"><code>vignettes/pastclim_overview.Rmd</code></a></small>
      <div class="d-none name"><code>pastclim_overview.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="install-the-library">Install the library<a class="anchor" aria-label="anchor" href="#install-the-library"></a>
</h2>
<p>You will need to install the library from Github. For this step, you will need to use <code>devtools</code> (if you haven’t done so already, install it from CRAN with <code>install.packages("devtools")</code>. Once you have <code>devtools</code>, simply use:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"EvolEcolGroup/pastclim"</span><span class="op">)</span></span></code></pre></div>
<p>There is a vignette with detailed step by step examples on how to use the library. You can find it on the website for the package. Or, if when can build it when installing <code>pastclim</code> :</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"EvolEcolGroup/pastclim"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>And read it directly in R with:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"pastclim_overview"</span>, package <span class="op">=</span> <span class="st">"pastclim"</span><span class="op">)</span></span></code></pre></div>
<p>Depending on the operating system you use, you might need additional packages to build a vignette. —</p>
<p>NOTE: <code>pastclim</code> relies on <code>terra</code> to process rasters. There is a known bug in <code>terra</code> that leads to the occasional message:</p>
<pre><code><span><span class="st">"Error in x$.self$finalize() : attempt to apply non-function"</span></span></code></pre>
<p>being reported. This is an error related to garbage collection, which does not affect the script being correctly executed, so it can be ignored. More discussion of this issue can be found on <a href="https://stackoverflow.com/questions/61598340/why-does-rastertopoints-generate-an-error-on-first-call-but-not-second" class="external-link">stack<strong>overflow</strong></a></p>
</div>
<div class="section level2">
<h2 id="download-the-data">Download the data<a class="anchor" aria-label="anchor" href="#download-the-data"></a>
</h2>
<p>You will need to download climatic reconstructions before being able to do any work with <code>pastclim</code>. Currently the library contains two datasets: <em>Beyer2020</em> which covers the last 120k years; and, for project that go further back in time, <em>Krapp2021</em> which goes back to 800kya. For these two datasets, there are functions that help you download the data and choose the variables. It is possible to add additional, custom datasets, but you will need some familiarity with handling <code>netcdf</code> files (see the vignette on ‘Formatting data to use in pastclim’).</p>
<p>Datasets will stored in the package data path, which can be obtained with:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EvolEcolGroup/pastclim" class="external-link">pastclim</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_data_path.html">get_data_path</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/.local/share/R/pastclim"</span></span></code></pre></div>
<p>If you prefer using a custom path (e.g. in “~/my_reconstructions”), it can be set with:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_data_path.html">set_data_path</a></span><span class="op">(</span>path_to_nc <span class="op">=</span> <span class="st">"~/my_reconstructions"</span><span class="op">)</span></span></code></pre></div>
<p><code>pastclim</code> will remember this new path in the future, even after closing and restarting R.</p>
<p>The package includes a small dataset, <em>Example</em>, that we will use in this vignette; the real datasets are large (from 100s of Mb to a few Gb), and you will need to specify what you want to download (see below).</p>
<p>Let us start by inspecting the <em>Example</em> dataset. We can get a list of variables available for this dataset with:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_vars_for_dataset.html">get_vars_for_dataset</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Example"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "bio01" "bio10" "bio12" "biome"</span></span></code></pre></div>
<p>and the available time steps available can be obtained with:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_time_steps.html">get_time_steps</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Example"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -20000 -15000 -10000  -5000      0</span></span></code></pre></div>
<p>For <em>Beyer2020</em> and <em>Krapp2021</em>, you can get a list of available variables for each dataset with:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_vars_for_dataset.html">get_vars_for_dataset</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Beyer2020"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "bio01"                "bio04"                "bio05"               </span></span>
<span><span class="co">#&gt;  [4] "bio06"                "bio07"                "bio08"               </span></span>
<span><span class="co">#&gt;  [7] "bio09"                "bio10"                "bio11"               </span></span>
<span><span class="co">#&gt; [10] "bio12"                "bio13"                "bio14"               </span></span>
<span><span class="co">#&gt; [13] "bio15"                "bio16"                "bio17"               </span></span>
<span><span class="co">#&gt; [16] "bio18"                "bio19"                "npp"                 </span></span>
<span><span class="co">#&gt; [19] "lai"                  "biome"                "altitude"            </span></span>
<span><span class="co">#&gt; [22] "rugosity"             "temperature_01"       "temperature_02"      </span></span>
<span><span class="co">#&gt; [25] "temperature_03"       "temperature_04"       "temperature_05"      </span></span>
<span><span class="co">#&gt; [28] "temperature_06"       "temperature_07"       "temperature_08"      </span></span>
<span><span class="co">#&gt; [31] "temperature_09"       "temperature_10"       "temperature_11"      </span></span>
<span><span class="co">#&gt; [34] "temperature_12"       "precipitation_01"     "precipitation_02"    </span></span>
<span><span class="co">#&gt; [37] "precipitation_03"     "precipitation_04"     "precipitation_05"    </span></span>
<span><span class="co">#&gt; [40] "precipitation_06"     "precipitation_07"     "precipitation_08"    </span></span>
<span><span class="co">#&gt; [43] "precipitation_09"     "precipitation_10"     "precipitation_11"    </span></span>
<span><span class="co">#&gt; [46] "precipitation_12"     "cloudiness_01"        "cloudiness_02"       </span></span>
<span><span class="co">#&gt; [49] "cloudiness_03"        "cloudiness_04"        "cloudiness_05"       </span></span>
<span><span class="co">#&gt; [52] "cloudiness_06"        "cloudiness_07"        "cloudiness_08"       </span></span>
<span><span class="co">#&gt; [55] "cloudiness_09"        "cloudiness_10"        "cloudiness_11"       </span></span>
<span><span class="co">#&gt; [58] "cloudiness_12"        "relative_humidity_01" "relative_humidity_02"</span></span>
<span><span class="co">#&gt; [61] "relative_humidity_03" "relative_humidity_04" "relative_humidity_05"</span></span>
<span><span class="co">#&gt; [64] "relative_humidity_06" "relative_humidity_07" "relative_humidity_08"</span></span>
<span><span class="co">#&gt; [67] "relative_humidity_09" "relative_humidity_10" "relative_humidity_11"</span></span>
<span><span class="co">#&gt; [70] "relative_humidity_12" "wind_speed_01"        "wind_speed_02"       </span></span>
<span><span class="co">#&gt; [73] "wind_speed_03"        "wind_speed_04"        "wind_speed_05"       </span></span>
<span><span class="co">#&gt; [76] "wind_speed_06"        "wind_speed_07"        "wind_speed_08"       </span></span>
<span><span class="co">#&gt; [79] "wind_speed_09"        "wind_speed_10"        "wind_speed_11"       </span></span>
<span><span class="co">#&gt; [82] "wind_speed_12"        "mo_npp_01"            "mo_npp_02"           </span></span>
<span><span class="co">#&gt; [85] "mo_npp_03"            "mo_npp_04"            "mo_npp_05"           </span></span>
<span><span class="co">#&gt; [88] "mo_npp_06"            "mo_npp_07"            "mo_npp_08"           </span></span>
<span><span class="co">#&gt; [91] "mo_npp_09"            "mo_npp_10"            "mo_npp_11"           </span></span>
<span><span class="co">#&gt; [94] "mo_npp_12"</span></span></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_vars_for_dataset.html">get_vars_for_dataset</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Krapp2021"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "bio01"            "bio04"            "bio05"            "bio06"           </span></span>
<span><span class="co">#&gt;  [5] "bio07"            "bio08"            "bio09"            "bio10"           </span></span>
<span><span class="co">#&gt;  [9] "bio11"            "bio12"            "bio13"            "bio14"           </span></span>
<span><span class="co">#&gt; [13] "bio15"            "bio16"            "bio17"            "bio18"           </span></span>
<span><span class="co">#&gt; [17] "bio19"            "npp"              "biome"            "altitude"        </span></span>
<span><span class="co">#&gt; [21] "rugosity"         "temperature_01"   "temperature_02"   "temperature_03"  </span></span>
<span><span class="co">#&gt; [25] "temperature_04"   "temperature_05"   "temperature_06"   "temperature_07"  </span></span>
<span><span class="co">#&gt; [29] "temperature_08"   "temperature_09"   "temperature_10"   "temperature_11"  </span></span>
<span><span class="co">#&gt; [33] "temperature_12"   "precipitation_01" "precipitation_02" "precipitation_03"</span></span>
<span><span class="co">#&gt; [37] "precipitation_04" "precipitation_05" "precipitation_06" "precipitation_07"</span></span>
<span><span class="co">#&gt; [41] "precipitation_08" "precipitation_09" "precipitation_10" "precipitation_11"</span></span>
<span><span class="co">#&gt; [45] "precipitation_12" "mo_npp_01"        "mo_npp_02"        "mo_npp_03"       </span></span>
<span><span class="co">#&gt; [49] "mo_npp_04"        "mo_npp_05"        "mo_npp_06"        "mo_npp_07"       </span></span>
<span><span class="co">#&gt; [53] "mo_npp_08"        "mo_npp_09"        "mo_npp_10"        "mo_npp_11"       </span></span>
<span><span class="co">#&gt; [57] "mo_npp_12"        "cloudiness_01"    "cloudiness_02"    "cloudiness_03"   </span></span>
<span><span class="co">#&gt; [61] "cloudiness_04"    "cloudiness_05"    "cloudiness_06"    "cloudiness_07"   </span></span>
<span><span class="co">#&gt; [65] "cloudiness_08"    "cloudiness_09"    "cloudiness_10"    "cloudiness_11"   </span></span>
<span><span class="co">#&gt; [69] "cloudiness_12"</span></span></code></pre></div>
<p>You will not be able to get the available time steps until you download the data. <code>pastclim</code> offers an interface to download the necessary files into your data path.</p>
<p>To inspect which datasets and variables have already been downloaded in the data path, we can use:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_downloaded_datasets.html">get_downloaded_datasets</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $Example</span></span>
<span><span class="co">#&gt; [1] "bio01" "bio10" "bio12" "biome"</span></span></code></pre></div>
<p>Let’s now download <em>bio01</em> and <em>bio05</em> for the <em>Beyer2020</em> dataset (this operation might take several minutes, as the datasets are large; <code>R</code> will pause until the download is complete):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/download_dataset.html">download_dataset</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Beyer2020"</span>, bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio05"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Note that multiple variables are packed together into a single file, so the command might list more variables than the ones that we downloaded originally.</p>
<p>We have found that on some installations of R (mostly on macOS), the default data path chosen by R can lead to an error when downloading datasets (this is due to incorrect writing permission for that path). If you get an error when downloading data stating “Failed to open file …”, set the path with <code>set_data_path</code> to a directory in your user area, and the error should disappear when you issue again the <code>download_dataset</code> command.</p>
</div>
<div class="section level2">
<h2 id="get-climate-for-locations">Get climate for locations<a class="anchor" aria-label="anchor" href="#get-climate-for-locations"></a>
</h2>
<p>Often we want to get the climate for specific locations. We can do so by using the function <code>location_slice</code>. With this function, we will get slices of climate for the times relevant to the locations of interest.</p>
<p>Let us create some fictitious locations:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span>, <span class="op">-</span><span class="fl">120</span>, <span class="op">-</span><span class="fl">9</span><span class="op">)</span>, latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">45</span>, <span class="fl">60</span>, <span class="fl">37</span><span class="op">)</span>,</span>
<span>  time_bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">9753</span>, <span class="op">-</span><span class="fl">18738</span>, <span class="op">-</span><span class="fl">11849</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">locations</span></span>
<span><span class="co">#&gt;   longitude latitude time_bp</span></span>
<span><span class="co">#&gt; 1         0       20       0</span></span>
<span><span class="co">#&gt; 2        90       45   -9753</span></span>
<span><span class="co">#&gt; 3      -120       60  -18738</span></span>
<span><span class="co">#&gt; 4        -9       37  -11849</span></span></code></pre></div>
<p>And extract their climatic conditions for <em>bio01</em> and <em>bio12</em>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/location_slice.html">location_slice</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">locations</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  time_bp <span class="op">=</span> <span class="va">locations</span><span class="op">$</span><span class="va">time_bp</span>, bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span>, nn_interpol <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   longitude latitude time_bp time_bp_slice     bio01    bio12</span></span>
<span><span class="co">#&gt; 1         0       20       0             0 27.598463 86.26409</span></span>
<span><span class="co">#&gt; 2        90       45   -9753        -10000  5.648806 77.20958</span></span>
<span><span class="co">#&gt; 3      -120       60  -18738        -20000        NA       NA</span></span>
<span><span class="co">#&gt; 4        -9       37  -11849        -10000        NA       NA</span></span></code></pre></div>
<p><code>pastclim</code> finds the closest time steps (slices) available for a given date, and outputs the slice used in column <code>time_bp_slice</code> (the <em>Example</em> dataset that we use in this vignette has a temporal resolution of only 5k years).</p>
<p>Note that the last two locations, for the appropriate time steps, are not available (either under water or ice), and so <code>pastclim</code> does not return a climate reconstruction. In some instances, this is due to the discretisation of space in the raster. We can interpolate climate among the nearest neighbours, thus using climate reconstructions for neighbouring pixels if the location is just off one or more land pixels:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/location_slice.html">location_slice</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">locations</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  time_bp <span class="op">=</span> <span class="va">locations</span><span class="op">$</span><span class="va">time_bp</span>, bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span>, nn_interpol <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   longitude latitude time_bp time_bp_slice     bio01     bio12</span></span>
<span><span class="co">#&gt; 1         0       20       0             0 27.598463  86.26409</span></span>
<span><span class="co">#&gt; 2        90       45   -9753        -10000  5.648806  77.20958</span></span>
<span><span class="co">#&gt; 3      -120       60  -18738        -20000        NA        NA</span></span>
<span><span class="co">#&gt; 4        -9       37  -11849        -10000 15.843223 645.35519</span></span></code></pre></div>
<p>In this case, the last location is indeed just off the coast, and so we can reconstruct some appropriate climate by interpolating. Note that <code>nn_interpol = TRUE</code> is the default for this function.</p>
<p>Sometimes, we want to get a time series of climatic reconstructions, thus allowing us to see how climate changed over time:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">locations_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/location_series.html">location_series</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">locations</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The resulting dataframe can be subsetted to get the time series for each location (the small <em>Example</em> dataset only contains 5 time points):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">locations_ts</span>, <span class="va">id</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;     longitude latitude id   time    bio01     bio12</span></span>
<span><span class="co">#&gt; 1           0       20  1 -20000 22.44057 102.66345</span></span>
<span><span class="co">#&gt; 1.1         0       20  1 -15000 23.64338 147.15260</span></span>
<span><span class="co">#&gt; 1.2         0       20  1 -10000 25.56035 171.84576</span></span>
<span><span class="co">#&gt; 1.3         0       20  1  -5000 26.28267 139.80730</span></span>
<span><span class="co">#&gt; 1.4         0       20  1      0 27.59846  86.26409</span></span></code></pre></div>
<p>Also note that for some locations, climate can be available only for certain time steps, depending on sea level and ice sheet extent. This is the case for location 3:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">locations_ts</span>, <span class="va">id</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;     longitude latitude id   time     bio01    bio12</span></span>
<span><span class="co">#&gt; 3        -120       60  3 -20000       NaN      NaN</span></span>
<span><span class="co">#&gt; 3.1      -120       60  3 -15000       NaN      NaN</span></span>
<span><span class="co">#&gt; 3.2      -120       60  3 -10000 -3.707212 321.1735</span></span>
<span><span class="co">#&gt; 3.3      -120       60  3  -5000 -3.246998 386.2584</span></span>
<span><span class="co">#&gt; 3.4      -120       60  3      0 -3.118226 336.2031</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-climate-for-a-region">Get climate for a region<a class="anchor" aria-label="anchor" href="#get-climate-for-a-region"></a>
</h2>
<p>Instead of focussing on specific locations, we might want to look a whole region. For a given time step, we can extract a slice of climate with</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_20k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This returns a raster (technically a <code>spatRaster</code> object as defined in the <code>terra</code> library, meaning that we can perform all standard <code>terra</code> raster operations on this object). To interact with <code>spatRaster</code> objects, it is best to load the <code>terra</code> library; we can then get a summary of this object:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.6.7</span></span>
<span><span class="va">climate_20k</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 150, 360, 3  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1, 1  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 </span></span>
<span><span class="co">#&gt; sources     : example_climate.nc:BIO1  </span></span>
<span><span class="co">#&gt;               example_climate.nc:BIO10  </span></span>
<span><span class="co">#&gt;               example_climate.nc:BIO12  </span></span>
<span><span class="co">#&gt; varnames    : bio01 (Annual Mean Temperature) </span></span>
<span><span class="co">#&gt;               bio10 (Mean Temperature of Warmest Quarter) </span></span>
<span><span class="co">#&gt;               bio12 (Annual Precipitation) </span></span>
<span><span class="co">#&gt; names       : bio01, bio10, bio12 </span></span>
<span><span class="co">#&gt; time (raw)  : -20000</span></span></code></pre></div>
<p>and plot these three variables (the layers of the raster):</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_20k</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">climate_20k</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pastclim_overview_files/figure-html/unnamed-chunk-18-1.png" width="576"></p>
<p>Often we want to focus a given region. There are a number of preset extents in <code>pastclim</code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">region_extent</span></span>
<span><span class="co">#&gt; $Africa</span></span>
<span><span class="co">#&gt; [1] -19  61 -36  38</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $America</span></span>
<span><span class="co">#&gt; [1] -180  -15  -70   90</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Asia</span></span>
<span><span class="co">#&gt; [1]  60 180   5  85</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Europe</span></span>
<span><span class="co">#&gt; [1] -15  70  33  75</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Eurasia</span></span>
<span><span class="co">#&gt; [1] -15 180  33  85</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $N_America</span></span>
<span><span class="co">#&gt; [1] -180  -15   15   90</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Oceania</span></span>
<span><span class="co">#&gt; [1] 110 180 -50  10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $S_America</span></span>
<span><span class="co">#&gt; [1] -125  -31   58   35</span></span></code></pre></div>
<p>We can extract climate only for Europe; we need to pass an <code><a href="https://rdrr.io/pkg/terra/man/SpatExtent-class.html" class="external-link">terra::SpatExtent</a></code> object to <code>region_slice</code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">europe_climate_20k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span>,</span>
<span>  ext <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">region_extent</span><span class="op">$</span><span class="va">Europe</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">europe_climate_20k</span>,</span>
<span>            main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">europe_climate_20k</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pastclim_overview_files/figure-html/unnamed-chunk-20-1.png" width="576"></p>
<p>Alternatively, we can crop an already extracted raster:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">europe_climate_20k_alt</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">climate_20k</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">region_extent</span><span class="op">$</span><span class="va">Europe</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">europe_climate_20k_alt</span>,</span>
<span>            main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">europe_climate_20k_alt</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pastclim_overview_files/figure-html/unnamed-chunk-21-1.png" width="576"></p>
<p>We might want to use a more complex shape (i.e. a polygon, as a <code><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">terra::vect</a></code> object) as a mask to limit the area covered by the raster. For example, we might want to focus the 3 continents Africa, Europe and Asia, but exclude the Americas and Oceania. We need to create a polygon with the appropriate vertices (note that you need to reuse the first vertex as the last vertex, to close the polygon).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">afr_eurasia_vec</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="st">"POLYGON ((0 70, 25 70, 50 80, 170 80, 170 10,</span></span>
<span><span class="st">                              119 2.4, 119 0.8, 116 -7.6, 114 -12, 100 -40,</span></span>
<span><span class="st">                              -25 -40, -25 64, 0 70))"</span><span class="op">)</span></span>
<span><span class="va">climate_20k_afr_eurasia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span>,</span>
<span>  crop <span class="op">=</span> <span class="va">afr_eurasia_vec</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_20k_afr_eurasia</span>, </span>
<span>            main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">climate_20k_afr_eurasia</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pastclim_overview_files/figure-html/unnamed-chunk-22-1.png" width="576"></p>
<p><code>pastclim</code> includes a number of pre-generated masks for the main continental masses, stored in the dataset <code>continent_outlines</code> in an <code>sf</code> object. Note that outlines that cross the antimeridian are split into multiple polygons (so that they can be used without projecting the rasters). <code>continent_outlines_union</code> provides the same outlines as single polygons (in case you want to use a projection). We can build the outline for Africa and Eurasia by unioning the two individual outlines:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 6.3.1; sf_use_s2() is TRUE</span></span>
<span><span class="va">africa_outline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">region_outline</span>, <span class="va">region_outline</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Africa"</span><span class="op">)</span></span>
<span><span class="va">eurasia_outline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">region_outline</span>, <span class="va">region_outline</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Eurasia"</span><span class="op">)</span></span>
<span><span class="va">afr_eurasia_vec</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">africa_outline</span>, <span class="va">eurasia_outline</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: attribute variables are assumed to be spatially constant throughout all</span></span>
<span><span class="co">#&gt; geometries</span></span>
<span><span class="va">climate_20k_afr_eurasia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span>,</span>
<span>  crop <span class="op">=</span> <span class="va">afr_eurasia_vec</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_20k_afr_eurasia</span>,</span>
<span>            main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">climate_20k_afr_eurasia</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pastclim_overview_files/figure-html/unnamed-chunk-23-1.png" width="576"></p>
<p>Note that the Eurasian outline is intersected by the antimeridian, and so we have a small amount of data on the left hand side of the plot (corresponding to the eastern end of Siberia).</p>
<p>It is possible to also load a time series of rasters with the function <code>region_series</code>. In this case, the function returns a <code>spatRasterDataset</code>, with each variable as a sub-dataset:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_region</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_series.html">region_series</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>min<span class="op">=</span><span class="op">-</span><span class="fl">15000</span>,max<span class="op">=</span><span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">climate_region</span></span>
<span><span class="co">#&gt; class       : SpatRasterDataset </span></span>
<span><span class="co">#&gt; subdatasets : 3 </span></span>
<span><span class="co">#&gt; dimensions  : 150, 360 (nrow, ncol)</span></span>
<span><span class="co">#&gt; nlyr        : 4, 4, 4 </span></span>
<span><span class="co">#&gt; resolution  : 1, 1  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 </span></span>
<span><span class="co">#&gt; source(s)   : example_climate.nc </span></span>
<span><span class="co">#&gt; names       : bio01, bio10, bio12</span></span></code></pre></div>
<p>Each of these sub-dataset is a <code>spatRaster</code>, with time steps as layers:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_region</span><span class="op">$</span><span class="va">bio01</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 150, 360, 4  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1, 1  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 </span></span>
<span><span class="co">#&gt; source      : example_climate.nc:BIO1 </span></span>
<span><span class="co">#&gt; varname     : bio01 (Annual Mean Temperature) </span></span>
<span><span class="co">#&gt; names       : bio01_-15000, bio01_-10000, bio01_-5000, bio01_0 </span></span>
<span><span class="co">#&gt; time (raw)  : -15000 to 0</span></span></code></pre></div>
<p>We can then plot the time series of a given variable:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_region</span><span class="op">$</span><span class="va">bio01</span><span class="op">)</span></span></code></pre></div>
<p><img src="pastclim_overview_files/figure-html/unnamed-chunk-26-1.png" width="576"></p>
<p>To plot all climate variables for a given time step, we can slice the time series:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slice_10k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slice_region_series.html">slice_region_series</a></span><span class="op">(</span><span class="va">climate_region</span>, time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">10000</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">slice_10k</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">slice_10k</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pastclim_overview_files/figure-html/unnamed-chunk-27-1.png" width="576"></p>
<p><code>region_series</code> takes the same <code>ext</code> and <code>crop</code> options as <code>region_slice</code> to limit the extent of the climatic reconstrutions.</p>
</div>
<div class="section level2">
<h2 id="working-with-biomes-and-ice-sheets">Working with biomes and ice sheets<a class="anchor" aria-label="anchor" href="#working-with-biomes-and-ice-sheets"></a>
</h2>
<p>The climate reconstructions do not show areas under permanent ice. Ice sheets are stored as class 28 in the “biome” variable:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_biome_classes.html">get_biome_classes</a></span><span class="op">(</span><span class="st">"Example"</span><span class="op">)</span></span>
<span><span class="co">#&gt;    id                           category</span></span>
<span><span class="co">#&gt; 1   0                       Water bodies</span></span>
<span><span class="co">#&gt; 2   1          Tropical evergreen forest</span></span>
<span><span class="co">#&gt; 3   2     Tropical semi-deciduous forest</span></span>
<span><span class="co">#&gt; 4   3 Tropical deciduous forest/woodland</span></span>
<span><span class="co">#&gt; 5   4         Temperate deciduous forest</span></span>
<span><span class="co">#&gt; 6   5           Temperate conifer forest</span></span>
<span><span class="co">#&gt; 7   6                  Warm mixed forest</span></span>
<span><span class="co">#&gt; 8   7                  Cool mixed forest</span></span>
<span><span class="co">#&gt; 9   8                Cool conifer forest</span></span>
<span><span class="co">#&gt; 10  9                  Cold mixed forest</span></span>
<span><span class="co">#&gt; 11 10      Evegreen taiga/montane forest</span></span>
<span><span class="co">#&gt; 12 11     Deciduous taiga/montane forest</span></span>
<span><span class="co">#&gt; 13 12                   Tropical savanna</span></span>
<span><span class="co">#&gt; 14 13      Tropical xerophytic shrubland</span></span>
<span><span class="co">#&gt; 15 14     Temperate xerophytic shrubland</span></span>
<span><span class="co">#&gt; 16 15     Temperate sclerophyll woodland</span></span>
<span><span class="co">#&gt; 17 16      Temperate broadleaved savanna</span></span>
<span><span class="co">#&gt; 18 17              Open conifer woodland</span></span>
<span><span class="co">#&gt; 19 18                    Boreal parkland</span></span>
<span><span class="co">#&gt; 20 19                 Tropical grassland</span></span>
<span><span class="co">#&gt; 21 20                Temperate grassland</span></span>
<span><span class="co">#&gt; 22 21                             Desert</span></span>
<span><span class="co">#&gt; 23 22                      Steppe tundra</span></span>
<span><span class="co">#&gt; 24 23                       Shrub tundra</span></span>
<span><span class="co">#&gt; 25 24                 Dwarf shrub tundra</span></span>
<span><span class="co">#&gt; 26 25             Prostrate shrub tundra</span></span>
<span><span class="co">#&gt; 27 26    Cushion forb lichen moss tundra</span></span>
<span><span class="co">#&gt; 28 27                             Barren</span></span>
<span><span class="co">#&gt; 29 28                           Land ice</span></span></code></pre></div>
<p>To plot it, we extract the biome and then subset it to just that class</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_20k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"biome"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">climate_20k</span><span class="op">$</span><span class="va">ice</span> <span class="op">&lt;-</span> <span class="va">climate_20k</span><span class="op">$</span><span class="va">biome</span></span>
<span><span class="va">climate_20k</span><span class="op">$</span><span class="va">ice</span><span class="op">[</span><span class="va">climate_20k</span><span class="op">$</span><span class="va">ice</span> <span class="op">!=</span> <span class="fl">28</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span><span class="va">climate_20k</span><span class="op">$</span><span class="va">ice</span><span class="op">[</span><span class="va">climate_20k</span><span class="op">$</span><span class="va">ice</span> <span class="op">==</span> <span class="fl">28</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_20k</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">climate_20k</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pastclim_overview_files/figure-html/unnamed-chunk-29-1.png" width="576"></p>
<p>Or more simply, we use functions designed to get ice and land masks.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_20k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">climate_20k</span><span class="op">$</span><span class="va">ice_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ice_mask.html">get_ice_mask</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20000</span>, dataset <span class="op">=</span> <span class="st">"Example"</span><span class="op">)</span></span>
<span><span class="va">climate_20k</span><span class="op">$</span><span class="va">land_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_land_mask.html">get_land_mask</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20000</span>, dataset <span class="op">=</span> <span class="st">"Example"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_20k</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">climate_20k</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pastclim_overview_files/figure-html/unnamed-chunk-30-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="set-the-samples-within-the-background">Set the samples within the background<a class="anchor" aria-label="anchor" href="#set-the-samples-within-the-background"></a>
</h2>
<p>We can visualise the environment for this time step with a PCA:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_10k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10000</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">climate_values_10k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">climate_10k</span><span class="op">)</span></span>
<span><span class="va">climate_values_10k</span> <span class="op">&lt;-</span> <span class="va">climate_values_10k</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.nan</a></span><span class="op">(</span><span class="va">climate_values_10k</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">climate_10k_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">climate_values_10k</span>, scale <span class="op">=</span> <span class="cn">TRUE</span>, center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_10k_pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">~</span> <span class="va">climate_10k_pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"lightgray"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"PC1"</span>, ylab <span class="op">=</span> <span class="st">"PC2"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="pastclim_overview_files/figure-html/unnamed-chunk-31-1.png" width="384"></p>
<p>We can now get the climate variables for the locations at this time step, compute the PCA scores and plots the locations on top of the background climate:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">locations_10k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/location_slice.html">location_slice</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">locations</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  time_bp <span class="op">=</span> <span class="va">locations</span><span class="op">$</span><span class="va">time_bp</span>, bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">locations_10k</span> <span class="op">&lt;-</span> <span class="va">locations_10k</span><span class="op">[</span><span class="va">locations_10k</span><span class="op">$</span><span class="va">time_bp_slice</span> <span class="op">==</span> <span class="op">-</span><span class="fl">10000</span>, <span class="op">]</span></span>
<span><span class="va">locations_10k_climate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/location_slice.html">location_slice</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">locations_10k</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  time_bp <span class="op">=</span> <span class="va">locations_10k</span><span class="op">$</span><span class="va">time_bp</span>, bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">locations_10k_pca_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">climate_10k_pca</span>, newdata <span class="op">=</span> <span class="va">locations_10k_climate</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_10k_pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">~</span> <span class="va">climate_10k_pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"lightgray"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"PC1"</span>, ylab <span class="op">=</span> <span class="st">"PC2"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">locations_10k_pca_scores</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pastclim_overview_files/figure-html/unnamed-chunk-32-1.png" width="384"></p>
<div class="section level3">
<h3 id="working-with-mis">Working with MIS<a class="anchor" aria-label="anchor" href="#working-with-mis"></a>
</h3>
<p>Sometimes we want to work with multiple time steps to represent a given MIS. We can get a list of time steps available for a given mis with:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mis_time_steps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_mis_time_steps.html">get_mis_time_steps</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"Example"</span><span class="op">)</span></span>
<span><span class="va">mis_time_steps</span></span>
<span><span class="co">#&gt; [1] -10000  -5000      0</span></span></code></pre></div>
<p>And now cycle over those steps. First extract the climate into a list:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mis_climate_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">this_step</span> <span class="kw">in</span> <span class="va">mis_time_steps</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">this_step_climate</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>      time_bp <span class="op">=</span> <span class="va">this_step</span>,</span>
<span>      bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>      dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="va">this_step_climate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">this_step_climate</span><span class="op">)</span></span>
<span>  <span class="co"># remove NAs</span></span>
<span>  <span class="va">this_step_climate</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">this_step_climate</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.nan</a></span><span class="op">(</span><span class="va">this_step_climate</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">mis_climate_list</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">this_step</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">this_step_climate</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then combine them into a single matrix:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mis_climate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">mis_climate_list</span><span class="op">)</span></span></code></pre></div>
<p>And finally plot it:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mis_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">mis_climate</span>, scale <span class="op">=</span> <span class="cn">TRUE</span>, center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mis_pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">~</span> <span class="va">mis_pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"lightgray"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"PC1"</span>, ylab <span class="op">=</span> <span class="st">"PC2"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="pastclim_overview_files/figure-html/unnamed-chunk-36-1.png" width="384"></p>
</div>
</div>
<div class="section level2">
<h2 id="random-sampling-of-background">Random sampling of background<a class="anchor" aria-label="anchor" href="#random-sampling-of-background"></a>
</h2>
<p>NOTE: there is a bug in terra 1.6.17 that prevents this section from working; you will get a “negative probability” error when sampling if you use that version.</p>
<p>For a number of species distribution models, we need to subsample background points to our presences. If we are interested in a single time step, we can simple generate the raster for the time slice of interest, and use <code>sample_region_slice</code>:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_20k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">this_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_region_slice.html">sample_region_slice</a></span><span class="op">(</span><span class="va">climate_20k</span>, size <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">this_sample</span><span class="op">)</span></span>
<span><span class="co">#&gt;    cell     x    y      bio01    bio10</span></span>
<span><span class="co">#&gt; 1 14954  13.5 48.5  0.8084163 10.02328</span></span>
<span><span class="co">#&gt; 2 11407  66.5 58.5 -9.9745779 12.81296</span></span>
<span><span class="co">#&gt; 3 22501   0.5 27.5 19.3944244 29.05527</span></span>
<span><span class="co">#&gt; 4 22856  -4.5 26.5 20.0186481 28.42356</span></span>
<span><span class="co">#&gt; 5 19738 117.5 35.5  9.0533886 22.96060</span></span>
<span><span class="co">#&gt; 6 24743  82.5 21.5 23.3264236 29.29441</span></span></code></pre></div>
<p>If we needed to get other variables for those coordinates, we could simply:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">additional_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/location_slice.html">location_slice</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>longitude <span class="op">=</span> <span class="va">this_sample</span><span class="op">$</span><span class="va">x</span>, latitude <span class="op">=</span> <span class="va">this_sample</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,</span>
<span>  time_bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20000</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">this_sample</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">additional_var</span><span class="op">)</span></span>
<span><span class="co">#&gt;   longitude latitude time_bp time_bp_slice     bio12</span></span>
<span><span class="co">#&gt; 1      13.5     48.5  -20000        -20000 670.82288</span></span>
<span><span class="co">#&gt; 2      66.5     58.5  -20000        -20000 272.53018</span></span>
<span><span class="co">#&gt; 3       0.5     27.5  -20000        -20000  11.32761</span></span>
<span><span class="co">#&gt; 4      -4.5     26.5  -20000        -20000  23.90315</span></span>
<span><span class="co">#&gt; 5     117.5     35.5  -20000        -20000 397.41644</span></span>
<span><span class="co">#&gt; 6      82.5     21.5  -20000        -20000 902.86743</span></span></code></pre></div>
<p>Alternatively, we could use the cell number:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">additional_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/location_slice.html">location_slice</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">this_sample</span><span class="op">$</span><span class="va">cell</span>,</span>
<span>  time_bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20000</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">this_sample</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">additional_var</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cell_number time_bp time_bp_slice     bio12</span></span>
<span><span class="co">#&gt; 1       14954  -20000        -20000 670.82288</span></span>
<span><span class="co">#&gt; 2       11407  -20000        -20000 272.53018</span></span>
<span><span class="co">#&gt; 3       22501  -20000        -20000  11.32761</span></span>
<span><span class="co">#&gt; 4       22856  -20000        -20000  23.90315</span></span>
<span><span class="co">#&gt; 5       19738  -20000        -20000 397.41644</span></span>
<span><span class="co">#&gt; 6       24743  -20000        -20000 902.86743</span></span></code></pre></div>
<p>We can also sample the background for multiple time steps (e.g. if we want to match the background to the number of samples based on their radiocarbon dates). So, for example, if we wanted 3 samples from 20k years ago and 5 samples from 10k years ago:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_series.html">region_series</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20000</span>,<span class="op">-</span><span class="fl">10000</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span>,</span>
<span>  ext <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">region_extent</span><span class="op">$</span><span class="va">Europe</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sampled_climate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_region_series.html">sample_region_series</a></span><span class="op">(</span><span class="va">climate_ts</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sampled_climate</span></span>
<span><span class="co">#&gt;          cell    x    y     bio01    bio10      bio12 time_bp</span></span>
<span><span class="co">#&gt; -20000.1 3374 43.5 35.5 17.017353 27.88568  268.29761  -20000</span></span>
<span><span class="co">#&gt; -20000.2 3556 55.5 33.5 15.644857 25.59466   68.47096  -20000</span></span>
<span><span class="co">#&gt; -20000.3 2963 57.5 40.5  8.889895 20.36036   97.48357  -20000</span></span>
<span><span class="co">#&gt; -10000.1 3134 58.5 38.5 14.942838 31.61710  155.89046  -10000</span></span>
<span><span class="co">#&gt; -10000.2 2864 43.5 41.5  2.272758 18.18176  660.12994  -10000</span></span>
<span><span class="co">#&gt; -10000.3 2197 56.5 49.5  3.067279 24.65434  234.81911  -10000</span></span>
<span><span class="co">#&gt; -10000.4 2456 60.5 46.5  5.563390 27.51768  100.58378  -10000</span></span>
<span><span class="co">#&gt; -10000.5 1881 -4.5 52.5  8.183455 14.04215 1739.80518  -10000</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michela Leonardi, Andrea Manica.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
