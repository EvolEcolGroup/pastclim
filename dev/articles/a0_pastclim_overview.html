<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="pastclim">
<title>pastclim overview • pastclim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="pastclim overview">
<meta property="og:description" content="pastclim">
<meta property="og:image" content="https://evolecolgroup.github.io/pastclim/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">pastclim</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.2.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a0_pastclim_overview.html">pastclim overview</a>
    <a class="dropdown-item" href="../articles/a1_available_datasets.html">available datasets</a>
    <a class="dropdown-item" href="../articles/a2_custom_datasets.html">custom dataset</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="nav-link" href=".././pastclim_cheatsheet.pdf">Cheatsheet</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/EvolEcolGroup/pastclim/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>pastclim overview</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EvolEcolGroup/pastclim/blob/HEAD/vignettes/a0_pastclim_overview.Rmd" class="external-link"><code>vignettes/a0_pastclim_overview.Rmd</code></a></small>
      <div class="d-none name"><code>a0_pastclim_overview.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="install-the-library">Install the library<a class="anchor" aria-label="anchor" href="#install-the-library"></a>
</h2>
<p>You will need to install the library from GitHub. For this step, you
will need to use <code>devtools</code> (if you haven’t done so already,
install it from CRAN with <code>install.packages("devtools")</code>.
Once you have <code>devtools</code>, simply use:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"EvolEcolGroup/pastclim"</span><span class="op">)</span></span></code></pre></div>
<p>There is a vignette with detailed step by step examples on how to use
the library. You can find it on the website for the package. Or, if
needed, you can build it when installing <code>pastclim</code> :</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"EvolEcolGroup/pastclim"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>And read it directly in R with:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"pastclim_overview"</span>, package <span class="op">=</span> <span class="st">"pastclim"</span><span class="op">)</span></span></code></pre></div>
<p>Depending on the operating system you use, you might need additional
packages to build a vignette.</p>
<hr>
<p>NOTE: <code>pastclim</code> relies on <code>terra</code> to process
rasters. There is a known bug in <code>terra</code> that leads to the
occasional message:</p>
<pre><code><span><span class="st">"Error in x$.self$finalize() : attempt to apply non-function"</span></span></code></pre>
<p>being reported. This is an error related to garbage collection, which
does not affect the script being correctly executed, so it can be
ignored. More discussion of this issue can be found on <a href="https://stackoverflow.com/questions/61598340/why-does-rastertopoints-generate-an-error-on-first-call-but-not-second" class="external-link">stack<strong>overflow</strong></a></p>
</div>
<div class="section level2">
<h2 id="download-the-data">Download the data<a class="anchor" aria-label="anchor" href="#download-the-data"></a>
</h2>
<p>You will need to download climatic reconstructions before being able
to do any work with <code>pastclim</code>. Currently the library
contains two datasets: <em>Beyer2020</em> which covers the last 120k
years; and, for project that go further back in time, <em>Krapp2021</em>
which goes back to 800kya. It is possible to add additional, custom
datasets, but you will need some familiarity with handling
<code>netcdf</code> files (see the vignette on ‘custom dataset’).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"custom_datasets"</span>, package <span class="op">=</span> <span class="st">"pastclim"</span><span class="op">)</span></span></code></pre></div>
<p>A list of all datasets available can be obtained by typing</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"available_datasets"</span>, package <span class="op">=</span> <span class="st">"pastclim"</span><span class="op">)</span></span></code></pre></div>
<p>Please be aware that using any dataset made available to pastclim
will require to cite both pastclim and the original publication
presenting the dataset. The reference to cite for pastclim can be
obtained by typing</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"pastclim"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To cite pastclim in publications use:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Leonardi M, Hallet EY, Beyer R, Krapp M, Manica A (2022). “pastclim:</span></span>
<span><span class="co">#&gt;   an R package to easily access and use palaeoclimatic</span></span>
<span><span class="co">#&gt;   reconstructions.” bioRxiv. &lt;URL:</span></span>
<span><span class="co">#&gt;   https://www.biorxiv.org/content/10.1101/2022.05.18.492456v1&gt;.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   @Article{,</span></span>
<span><span class="co">#&gt;     title = {pastclim: an R package to easily access and use palaeoclimatic reconstructions},</span></span>
<span><span class="co">#&gt;     author = {Michela Leonardi and Emily Y. Hallet and Robert Beyer and Mario Krapp and Andrea Manica},</span></span>
<span><span class="co">#&gt;     journal = {bioRxiv},</span></span>
<span><span class="co">#&gt;     year = {2022},</span></span>
<span><span class="co">#&gt;     url = {https://www.biorxiv.org/content/10.1101/2022.05.18.492456v1},</span></span>
<span><span class="co">#&gt;   }</span></span></code></pre></div>
<p>while the reference associated to any dataset of choice (in this case
“Beyer2020”) is displayed together with the general information on it
through the command:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="st">"Beyer2020"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Documentation for the Beyer2020 dataset</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Description:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      This dataset covers the last 120k years, at intervals of 1/2 k</span></span>
<span><span class="co">#&gt;      years, and a resolution of 0.5 degrees in latitude and longitude.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Details:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      If you use this dataset, make sure to cite the original</span></span>
<span><span class="co">#&gt;      publication:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Beyer, R.M., Krapp, M. &amp; Manica, A. High-resolution terrestrial</span></span>
<span><span class="co">#&gt;      climate, bioclimate and vegetation for the last 120,000 years. Sci</span></span>
<span><span class="co">#&gt;      Data 7, 236 (2020). doi:doi.org/10.1038/s41597-020-0552-1</span></span>
<span><span class="co">#&gt;      &lt;https://doi.org/doi.org/10.1038/s41597-020-0552-1&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      The version included in `pastclim` has the ice sheets masked, as</span></span>
<span><span class="co">#&gt;      well as internal seas (Black and Caspian Sea) removed. The latter</span></span>
<span><span class="co">#&gt;      are based on:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      &lt;https://www.marineregions.org/gazetteer.php?p=details&amp;id=4278&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      &lt;https://www.marineregions.org/gazetteer.php?p=details&amp;id=4282&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      As there is no reconstruction of their depth through time, modern</span></span>
<span><span class="co">#&gt;      outlines were used for all time steps.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Also, for bio15, the coefficient of variation was computed after</span></span>
<span><span class="co">#&gt;      adding one to monthly estimates, and it was multiplied by 100</span></span>
<span><span class="co">#&gt;      following &lt;https://pubs.usgs.gov/ds/691/ds691.pdf&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Changelog</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      v1.1.0 Added monthly variables. Files can be downloaded from:</span></span>
<span><span class="co">#&gt;      &lt;https://zenodo.org/deposit/7062281&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      v1.0.0 Remove ice sheets and internal seas, and use correct</span></span>
<span><span class="co">#&gt;      formula for bio15. Files can be downloaded from:</span></span>
<span><span class="co">#&gt;      doi:doi.org/10.6084/m9.figshare.19723405.v1</span></span>
<span><span class="co">#&gt;      &lt;https://doi.org/doi.org/10.6084/m9.figshare.19723405.v1&gt;</span></span></code></pre>
<p>For the datasets available in <code>pastclim</code>, there are
functions that help you download the data and choose the variables. When
you start <code>pastclim</code> for the first time, you will need to set
the path where reconstructions are stored using
<code>set_data_path</code>. By default, the package data path will be
used:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EvolEcolGroup/pastclim" class="external-link">pastclim</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/set_data_path.html">set_data_path</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Loading required package: terra</span></span>
<span><span class="co">#&gt; terra 1.7.18</span></span></code></pre>
<pre><code><span><span class="co">#&gt; The data_path will be set to /home/andrea/.local/share/R/pastclim.</span></span>
<span><span class="co">#&gt; A copy of the Example dataset will be copied there.</span></span>
<span><span class="co">#&gt; This path will be saved by pastclim for future use.</span></span>
<span><span class="co">#&gt; Proceed? </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1: Yes</span></span>
<span><span class="co">#&gt; 2: No</span></span></code></pre>
<p>Press 1 if you are happy with the offered choices, and
<code>pastclim</code> will remember your data path in future sessions.
Note that your data path will look different than in this example, as it
depends on your user name and operating system.</p>
<p>If you prefer using a custom path (e.g. in “~/my_reconstructions”),
it can be set with:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_data_path.html">set_data_path</a></span><span class="op">(</span>path_to_nc <span class="op">=</span> <span class="st">"~/my_reconstructions"</span><span class="op">)</span></span></code></pre></div>
<p>The package includes a small dataset, <em>Example</em>, that we will
use in this vignette but is not suitable for running analyses; the real
datasets are large (from 100s of Mb to a few Gb), and you will need to
specify what you want to download (see below).</p>
<p>Let us start by inspecting the <em>Example</em> dataset. We can get a
list of variables available for this dataset with:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_vars_for_dataset.html">get_vars_for_dataset</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Example"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "bio01" "bio10" "bio12" "biome"</span></span></code></pre></div>
<p>and the available time steps can be obtained with:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_time_steps.html">get_time_steps</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Example"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -20000 -15000 -10000  -5000      0</span></span></code></pre></div>
<p>For <em>Beyer2020</em> and <em>Krapp2021</em>, you can get a list of
available variables for each dataset with:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_vars_for_dataset.html">get_vars_for_dataset</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Beyer2020"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "bio01"                "bio04"                "bio05"               </span></span>
<span><span class="co">#&gt;  [4] "bio06"                "bio07"                "bio08"               </span></span>
<span><span class="co">#&gt;  [7] "bio09"                "bio10"                "bio11"               </span></span>
<span><span class="co">#&gt; [10] "bio12"                "bio13"                "bio14"               </span></span>
<span><span class="co">#&gt; [13] "bio15"                "bio16"                "bio17"               </span></span>
<span><span class="co">#&gt; [16] "bio18"                "bio19"                "npp"                 </span></span>
<span><span class="co">#&gt; [19] "lai"                  "biome"                "altitude"            </span></span>
<span><span class="co">#&gt; [22] "rugosity"             "temperature_01"       "temperature_02"      </span></span>
<span><span class="co">#&gt; [25] "temperature_03"       "temperature_04"       "temperature_05"      </span></span>
<span><span class="co">#&gt; [28] "temperature_06"       "temperature_07"       "temperature_08"      </span></span>
<span><span class="co">#&gt; [31] "temperature_09"       "temperature_10"       "temperature_11"      </span></span>
<span><span class="co">#&gt; [34] "temperature_12"       "precipitation_01"     "precipitation_02"    </span></span>
<span><span class="co">#&gt; [37] "precipitation_03"     "precipitation_04"     "precipitation_05"    </span></span>
<span><span class="co">#&gt; [40] "precipitation_06"     "precipitation_07"     "precipitation_08"    </span></span>
<span><span class="co">#&gt; [43] "precipitation_09"     "precipitation_10"     "precipitation_11"    </span></span>
<span><span class="co">#&gt; [46] "precipitation_12"     "cloudiness_01"        "cloudiness_02"       </span></span>
<span><span class="co">#&gt; [49] "cloudiness_03"        "cloudiness_04"        "cloudiness_05"       </span></span>
<span><span class="co">#&gt; [52] "cloudiness_06"        "cloudiness_07"        "cloudiness_08"       </span></span>
<span><span class="co">#&gt; [55] "cloudiness_09"        "cloudiness_10"        "cloudiness_11"       </span></span>
<span><span class="co">#&gt; [58] "cloudiness_12"        "relative_humidity_01" "relative_humidity_02"</span></span>
<span><span class="co">#&gt; [61] "relative_humidity_03" "relative_humidity_04" "relative_humidity_05"</span></span>
<span><span class="co">#&gt; [64] "relative_humidity_06" "relative_humidity_07" "relative_humidity_08"</span></span>
<span><span class="co">#&gt; [67] "relative_humidity_09" "relative_humidity_10" "relative_humidity_11"</span></span>
<span><span class="co">#&gt; [70] "relative_humidity_12" "wind_speed_01"        "wind_speed_02"       </span></span>
<span><span class="co">#&gt; [73] "wind_speed_03"        "wind_speed_04"        "wind_speed_05"       </span></span>
<span><span class="co">#&gt; [76] "wind_speed_06"        "wind_speed_07"        "wind_speed_08"       </span></span>
<span><span class="co">#&gt; [79] "wind_speed_09"        "wind_speed_10"        "wind_speed_11"       </span></span>
<span><span class="co">#&gt; [82] "wind_speed_12"        "mo_npp_01"            "mo_npp_02"           </span></span>
<span><span class="co">#&gt; [85] "mo_npp_03"            "mo_npp_04"            "mo_npp_05"           </span></span>
<span><span class="co">#&gt; [88] "mo_npp_06"            "mo_npp_07"            "mo_npp_08"           </span></span>
<span><span class="co">#&gt; [91] "mo_npp_09"            "mo_npp_10"            "mo_npp_11"           </span></span>
<span><span class="co">#&gt; [94] "mo_npp_12"</span></span></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_vars_for_dataset.html">get_vars_for_dataset</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Krapp2021"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "bio01"            "bio04"            "bio05"            "bio06"           </span></span>
<span><span class="co">#&gt;  [5] "bio07"            "bio08"            "bio09"            "bio10"           </span></span>
<span><span class="co">#&gt;  [9] "bio11"            "bio12"            "bio13"            "bio14"           </span></span>
<span><span class="co">#&gt; [13] "bio15"            "bio16"            "bio17"            "bio18"           </span></span>
<span><span class="co">#&gt; [17] "bio19"            "npp"              "biome"            "lai"             </span></span>
<span><span class="co">#&gt; [21] "altitude"         "rugosity"         "temperature_01"   "temperature_02"  </span></span>
<span><span class="co">#&gt; [25] "temperature_03"   "temperature_04"   "temperature_05"   "temperature_06"  </span></span>
<span><span class="co">#&gt; [29] "temperature_07"   "temperature_08"   "temperature_09"   "temperature_10"  </span></span>
<span><span class="co">#&gt; [33] "temperature_11"   "temperature_12"   "precipitation_01" "precipitation_02"</span></span>
<span><span class="co">#&gt; [37] "precipitation_03" "precipitation_04" "precipitation_05" "precipitation_06"</span></span>
<span><span class="co">#&gt; [41] "precipitation_07" "precipitation_08" "precipitation_09" "precipitation_10"</span></span>
<span><span class="co">#&gt; [45] "precipitation_11" "precipitation_12" "mo_npp_01"        "mo_npp_02"       </span></span>
<span><span class="co">#&gt; [49] "mo_npp_03"        "mo_npp_04"        "mo_npp_05"        "mo_npp_06"       </span></span>
<span><span class="co">#&gt; [53] "mo_npp_07"        "mo_npp_08"        "mo_npp_09"        "mo_npp_10"       </span></span>
<span><span class="co">#&gt; [57] "mo_npp_11"        "mo_npp_12"        "cloudiness_01"    "cloudiness_02"   </span></span>
<span><span class="co">#&gt; [61] "cloudiness_03"    "cloudiness_04"    "cloudiness_05"    "cloudiness_06"   </span></span>
<span><span class="co">#&gt; [65] "cloudiness_07"    "cloudiness_08"    "cloudiness_09"    "cloudiness_10"   </span></span>
<span><span class="co">#&gt; [69] "cloudiness_11"    "cloudiness_12"</span></span></code></pre></div>
<p>For monthly variables, months are coded as “_xx” at the end of the
variable names; e.g. “temperature_02” is the mean monthly temperature
for February. A more thorough description of each variable (including
the units) can be obtained with:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_vars_for_dataset.html">get_vars_for_dataset</a></span><span class="op">(</span>dataset<span class="op">=</span><span class="st">"Example"</span>, details <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;   variable                           long_name           units</span></span>
<span><span class="co">#&gt; 1    bio01             annual mean temperature degrees Celsius</span></span>
<span><span class="co">#&gt; 2    bio10 mean temperature of warmest quarter degrees Celsius</span></span>
<span><span class="co">#&gt; 3    bio12                annual precipitation     mm per year</span></span>
<span><span class="co">#&gt; 4    biome                 biome (from BIOME4)</span></span></code></pre></div>
<p>You will not be able to get the available time steps until you
download the data. <code>pastclim</code> offers an interface to download
the necessary files into your data path.</p>
<p>To inspect which datasets and variables have already been downloaded
in the data path, we can use:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_downloaded_datasets.html">get_downloaded_datasets</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $Example</span></span>
<span><span class="co">#&gt; [1] "bio01" "bio10" "bio12" "biome"</span></span></code></pre></div>
<p>Let’s now download <em>bio01</em> and <em>bio05</em> for the
<em>Beyer2020</em> dataset (this operation might take several minutes,
as the datasets are large; <code>R</code> will pause until the download
is complete):</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/download_dataset.html">download_dataset</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"Beyer2020"</span>, bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio05"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Note that multiple variables can be packed together into a single
file, so <code><a href="../reference/get_downloaded_datasets.html">get_downloaded_datasets()</a></code> might list more
variables than the ones that we chose to download (it depends on the
dataset).</p>
<p>When upgrading <code>pastclim</code>, new version of various datasets
might become available. This will make the previously downloaded
datasets obsolete, and you might suddenly be told by
<code>pastclim</code> that some variables have to be re-downloaded. This
can lead to the accumulation of old datasets in your data path. The
function <code><a href="../reference/clean_data_path.html">clean_data_path()</a></code> can be used to delete old files
that are no longer needed.</p>
</div>
<div class="section level2">
<h2 id="get-climate-for-locations">Get climate for locations<a class="anchor" aria-label="anchor" href="#get-climate-for-locations"></a>
</h2>
<p>Often we want to get the climate for specific locations. We can do so
by using the function <code>location_slice</code>. With this function,
we will get slices of climate for the times relevant to the locations of
interest.</p>
<p>Let us consider five possible locations of interest: Iho Eleru (a
Late Stone Age inland site in Nigeria), La Riera (a Late Palaeolithic
coastal site on Spain), Chalki (a Mesolithic site on a Greek island),
Oronsay (a Mesolithic site in the Scottish Hebrides), and Atlantis (the
fabled submersed city mentioned by Plato). For each site we have a date
(realistic, but made up) that we are interested in associating with
climatic reconstructions.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Iho Eleru"</span>,<span class="st">"La Riera"</span>, <span class="st">"Chalki"</span>, <span class="st">"Oronsay"</span>,<span class="st">"Atlantis"</span><span class="op">)</span>, </span>
<span>  longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="op">-</span><span class="fl">4</span>, <span class="fl">27</span>, <span class="op">-</span><span class="fl">6</span>, <span class="op">-</span><span class="fl">24</span><span class="op">)</span>, latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">44</span>, <span class="fl">36</span>, <span class="fl">56</span>, <span class="fl">31</span><span class="op">)</span>,</span>
<span>  time_bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">11200</span>, <span class="op">-</span><span class="fl">18738</span>,<span class="op">-</span><span class="fl">10227</span>, <span class="op">-</span><span class="fl">10200</span>, <span class="op">-</span><span class="fl">11600</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">locations</span></span>
<span><span class="co">#&gt;        name longitude latitude time_bp</span></span>
<span><span class="co">#&gt; 1 Iho Eleru         5        7  -11200</span></span>
<span><span class="co">#&gt; 2  La Riera        -4       44  -18738</span></span>
<span><span class="co">#&gt; 3    Chalki        27       36  -10227</span></span>
<span><span class="co">#&gt; 4   Oronsay        -6       56  -10200</span></span>
<span><span class="co">#&gt; 5  Atlantis       -24       31  -11600</span></span></code></pre></div>
<p>And extract their climatic conditions for <em>bio01</em> and
<em>bio12</em>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/location_slice.html">location_slice</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">locations</span>, bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span>, nn_interpol <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;        name longitude latitude time_bp time_bp_slice     bio01    bio12</span></span>
<span><span class="co">#&gt; 1 Iho Eleru         5        7  -11200        -10000 25.346703 2204.595</span></span>
<span><span class="co">#&gt; 2  La Riera        -4       44  -18738        -20000  5.741851 1149.570</span></span>
<span><span class="co">#&gt; 3    Chalki        27       36  -10227        -10000        NA       NA</span></span>
<span><span class="co">#&gt; 4   Oronsay        -6       56  -10200        -10000  6.937467 1362.824</span></span>
<span><span class="co">#&gt; 5  Atlantis       -24       31  -11600        -10000        NA       NA</span></span></code></pre></div>
<p><code>pastclim</code> finds the closest time steps (slices) available
for a given date, and outputs the slice used in column
<code>time_bp_slice</code> (the <em>Example</em> dataset that we use in
this vignette has a temporal resolution of only 5k years).</p>
<p>Note that the last Chalki and Atlantis, for the appropriate time
steps, are not available. This occurs when a location, in the
reconstructions, was either under water or ice, and so
<code>pastclim</code> can not return any estimate. In some instances,
this is due to the discretisation of space in the raster. We can
interpolate climate among the nearest neighbours, thus using climate
reconstructions for neighbouring pixels if the location is just off one
or more land pixels:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/location_slice.html">location_slice</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">locations</span>, bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span>, nn_interpol <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;        name longitude latitude time_bp time_bp_slice     bio01     bio12</span></span>
<span><span class="co">#&gt; 1 Iho Eleru         5        7  -11200        -10000 25.346703 2204.5950</span></span>
<span><span class="co">#&gt; 2  La Riera        -4       44  -18738        -20000  5.741851 1149.5703</span></span>
<span><span class="co">#&gt; 3    Chalki        27       36  -10227        -10000 17.432425  723.1012</span></span>
<span><span class="co">#&gt; 4   Oronsay        -6       56  -10200        -10000  6.937467 1362.8245</span></span>
<span><span class="co">#&gt; 5  Atlantis       -24       31  -11600        -10000        NA        NA</span></span></code></pre></div>
<p>For Chalki, we can see that the problem is indeed that, since it is a
small island, it is not well represented in the reconstructions (bear in
mind that the <code>Example</code> dataset is very coarse in
resolution), and so we can reconstruct some appropriate climate by
interpolating. Atlantis, on the other hand, is the middle of the ocean,
and so there is no information on what the climate might have been
before became submerged (assuming it ever existed…). Note that
<code>nn_interpol = TRUE</code> is the default for this function.</p>
<p>Sometimes, we want to get a time series of climatic reconstructions,
thus allowing us to see how climate changed over time:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">locations_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/location_series.html">location_series</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">locations</span>,</span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span><span class="op">)</span></span></code></pre></div>
<p>The resulting dataframe can be subsetted to get the time series for
each location (the small <em>Example</em> dataset only contains 5 time
slices):</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">locations_ts</span>, <span class="va">name</span> <span class="op">==</span> <span class="st">"Iho Eleru"</span><span class="op">)</span></span>
<span><span class="co">#&gt;     longitude latitude id   time    bio01    bio12      name</span></span>
<span><span class="co">#&gt; 1           5        7  1 -20000 22.55133 1577.238 Iho Eleru</span></span>
<span><span class="co">#&gt; 1.1         5        7  1 -15000 23.27008 1850.715 Iho Eleru</span></span>
<span><span class="co">#&gt; 1.2         5        7  1 -10000 25.34670 2204.595 Iho Eleru</span></span>
<span><span class="co">#&gt; 1.3         5        7  1  -5000 25.65009 2109.735 Iho Eleru</span></span>
<span><span class="co">#&gt; 1.4         5        7  1      0 26.77033 1840.845 Iho Eleru</span></span></code></pre></div>
<p>Also note that for some locations, climate can be available only for
certain time steps, depending on sea level and ice sheet extent. This is
the case for Oronsay:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">locations_ts</span>, <span class="va">name</span> <span class="op">==</span> <span class="st">"Oronsay"</span><span class="op">)</span></span>
<span><span class="co">#&gt;     longitude latitude id   time    bio01    bio12    name</span></span>
<span><span class="co">#&gt; 4          -6       56  4 -20000       NA       NA Oronsay</span></span>
<span><span class="co">#&gt; 4.1        -6       56  4 -15000       NA       NA Oronsay</span></span>
<span><span class="co">#&gt; 4.2        -6       56  4 -10000 6.937467 1362.824 Oronsay</span></span>
<span><span class="co">#&gt; 4.3        -6       56  4  -5000 8.167976 1462.253 Oronsay</span></span>
<span><span class="co">#&gt; 4.4        -6       56  4      0 8.185000 1434.490 Oronsay</span></span></code></pre></div>
<p>We can quickly plot <code>bio1</code> through time for the
locations:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">locations_ts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">bio01</span>, group<span class="op">=</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col<span class="op">=</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col<span class="op">=</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 12 rows containing missing values (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 12 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-23-1.png" width="384"></p>
<p>As expected, we don’t have data for Atlantis (as it is always
underwater), but we also fail to retrieve data for Chalki. This is
because <code>location_series</code> does not interpolate from nearest
neighbours. So, to get data for that island, we would have to change
slightly the coordinates to make sure it falls within a cell with
climatic information.</p>
<p>Pretty labels for environmental variables can be generated with
<code>var_labels</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">locations_ts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">bio01</span>, group<span class="op">=</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col<span class="op">=</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col<span class="op">=</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="../reference/var_labels.html">var_labels</a></span><span class="op">(</span><span class="st">"bio01"</span>, dataset<span class="op">=</span><span class="st">"Example"</span>, abbreviated<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"time BP (yr)"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 12 rows containing missing values (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 12 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-24-1.png" width="384"></p>
<p><em>Note</em> that these climatic reconstructions were extracted from
the <code>Example</code> dataset, which is very coarse, so they should
not be used to base any real inference about their environmental
conditions.</p>
</div>
<div class="section level2">
<h2 id="get-climate-for-a-region">Get climate for a region<a class="anchor" aria-label="anchor" href="#get-climate-for-a-region"></a>
</h2>
<p>Instead of focussing on specific locations, we might want to look at
a whole region. For a given time step, we can extract a slice of climate
with</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_20k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This returns a raster (technically a <code>SpatRaster</code> object
as defined in the <code>terra</code> library, meaning that we can
perform all standard <code>terra</code> raster operations on this
object). To interact with <code>SpatRaster</code> objects, it is best to
load the <code>terra</code> library (otherwise you might get errors as
the correct method is not found, e.g.  when plotting); we can then get a
summary of this object:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="va">climate_20k</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 150, 360, 3  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1, 1  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 </span></span>
<span><span class="co">#&gt; sources     : example_climate_v1.2.3.nc:BIO1  </span></span>
<span><span class="co">#&gt;               example_climate_v1.2.3.nc:BIO10  </span></span>
<span><span class="co">#&gt;               example_climate_v1.2.3.nc:BIO12  </span></span>
<span><span class="co">#&gt; varnames    : bio01 (annual mean temperature) </span></span>
<span><span class="co">#&gt;               bio10 (mean temperature of warmest quarter) </span></span>
<span><span class="co">#&gt;               bio12 (annual precipitation) </span></span>
<span><span class="co">#&gt; names       :           bio01,           bio10,       bio12 </span></span>
<span><span class="co">#&gt; unit        : degrees Celsius, degrees Celsius, mm per year </span></span>
<span><span class="co">#&gt; time (years): -18050</span></span></code></pre></div>
<p>and plot these three variables (the layers of the raster):</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_20k</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">climate_20k</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-27-1.png" width="576"></p>
<p>We can add more informative labels with <code>var_labels</code>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_20k</span>, main <span class="op">=</span> <span class="fu"><a href="../reference/var_labels.html">var_labels</a></span><span class="op">(</span><span class="va">climate_20k</span>, dataset <span class="op">=</span> <span class="st">"Example"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-28-1.png" width="576"></p>
<p>It is possible to also load a time series of rasters with the
function <code>region_series</code>. In this case, the function returns
a <code>SpatRasterDataset</code>, with each variable as a
sub-dataset:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_region</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_series.html">region_series</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>min <span class="op">=</span> <span class="op">-</span><span class="fl">15000</span>, max <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, </span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span><span class="op">)</span></span>
<span><span class="va">climate_region</span></span>
<span><span class="co">#&gt; class       : SpatRasterDataset </span></span>
<span><span class="co">#&gt; subdatasets : 3 </span></span>
<span><span class="co">#&gt; dimensions  : 150, 360 (nrow, ncol)</span></span>
<span><span class="co">#&gt; nlyr        : 4, 4, 4 </span></span>
<span><span class="co">#&gt; resolution  : 1, 1  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 </span></span>
<span><span class="co">#&gt; source(s)   : example_climate_v1.2.3.nc </span></span>
<span><span class="co">#&gt; names       : bio01, bio10, bio12</span></span></code></pre></div>
<p>Each of these sub-dataset is a <code>SpatRaster</code>, with time
steps as layers:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_region</span><span class="op">$</span><span class="va">bio01</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 150, 360, 4  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1, 1  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 </span></span>
<span><span class="co">#&gt; source      : example_climate_v1.2.3.nc:BIO1 </span></span>
<span><span class="co">#&gt; varname     : bio01 (annual mean temperature) </span></span>
<span><span class="co">#&gt; names       :    bio01_-15000,    bio01_-10000,     bio01_-5000,         bio01_0 </span></span>
<span><span class="co">#&gt; unit        : degrees Celsius, degrees Celsius, degrees Celsius, degrees Celsius </span></span>
<span><span class="co">#&gt; time (years): -13050 to 1950</span></span></code></pre></div>
<p>Note that <code>terra</code> stores dates in years a AD, not BP.</p>
<p>We can then plot the time series of a given variable (we relabel the
plots to use years bp):</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_region</span><span class="op">$</span><span class="va">bio01</span>, main<span class="op">=</span><span class="fu"><a href="../reference/time_bp.html">time_bp</a></span><span class="op">(</span><span class="va">climate_region</span><span class="op">$</span><span class="va">bio01</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-31-1.png" width="576"></p>
<p>To plot all climate variables for a given time step, we can slice the
time series:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slice_10k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slice_region_series.html">slice_region_series</a></span><span class="op">(</span><span class="va">climate_region</span>, time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">10000</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">slice_10k</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">slice_10k</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-32-1.png" width="576"></p>
<p>Instead of giving a minimum and maximum time step, you can also
provide specific time steps to <code>region_series</code>. Note that
<code>pastclim</code> has a function to get a vector of the time steps
for a given MIS in a dataset. For example, for MIS 1, we get:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mis1_steps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_mis_time_steps.html">get_mis_time_steps</a></span><span class="op">(</span>mis <span class="op">=</span> <span class="fl">1</span>, dataset <span class="op">=</span> <span class="st">"Example"</span><span class="op">)</span></span>
<span><span class="va">mis1_steps</span></span>
<span><span class="co">#&gt; [1] -10000  -5000      0</span></span></code></pre></div>
<p>Which we can then use:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_mis1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_series.html">region_series</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="va">mis1_steps</span>, </span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">climate_mis1</span></span>
<span><span class="co">#&gt; class       : SpatRasterDataset </span></span>
<span><span class="co">#&gt; subdatasets : 3 </span></span>
<span><span class="co">#&gt; dimensions  : 150, 360 (nrow, ncol)</span></span>
<span><span class="co">#&gt; nlyr        : 3, 3, 3 </span></span>
<span><span class="co">#&gt; resolution  : 1, 1  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 </span></span>
<span><span class="co">#&gt; source(s)   : example_climate_v1.2.3.nc </span></span>
<span><span class="co">#&gt; names       : bio01, bio10, bio12</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cropping">Cropping<a class="anchor" aria-label="anchor" href="#cropping"></a>
</h2>
<p>Often we want to focus a given region. There are a number of preset
rectangular extents in <code>pastclim</code>:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">region_extent</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Africa"    "America"   "Asia"      "Europe"    "Eurasia"   "N_America"</span></span>
<span><span class="co">#&gt; [7] "Oceania"   "S_America"</span></span></code></pre></div>
<p>We can get the corners of the European extent:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">region_extent</span><span class="op">$</span><span class="va">Europe</span></span>
<span><span class="co">#&gt; [1] -15  70  33  75</span></span></code></pre></div>
<p>And then we can extract climate only for Europe by setting
<code>ext</code> in <code>region_slice</code>:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">europe_climate_20k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span>,</span>
<span>  ext <span class="op">=</span> <span class="va">region_extent</span><span class="op">$</span><span class="va">Europe</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">europe_climate_20k</span>,</span>
<span>            main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">europe_climate_20k</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-37-1.png" width="576"></p>
<p>As we can see in the plot, cutting Europe using a rectangular shape
keeps a portion of Northern Africa in the map. <code>pastclim</code>
includes a number of pre-generated masks for the main continental
masses, stored in the dataset <code>region_outline</code> in an
<code><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">sf::sfc</a></code> object. We can get a list with:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">region_outline</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Africa"    "Eurasia"   "N_America" "Oceania"   "S_America" "Europe"</span></span></code></pre></div>
<p>We can then use the function <code>crop</code> within
<code>region_slice</code> to only keep the area within the desired
outline.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">europe_climate_20k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span>,</span>
<span>  crop <span class="op">=</span> <span class="va">region_outline</span><span class="op">$</span><span class="va">Europe</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">europe_climate_20k</span>,</span>
<span>            main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">europe_climate_20k</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-39-1.png" width="576"></p>
<p>We can combine multiple regions together. For example, we can crop to
Africa and Eurasia by unioning the two individual outlines:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</span></span>
<span><span class="va">afr_eurasia</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">region_outline</span><span class="op">$</span><span class="va">Africa</span>, <span class="va">region_outline</span><span class="op">$</span><span class="va">Eurasia</span><span class="op">)</span></span>
<span><span class="va">climate_20k_afr_eurasia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  bio_variables  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span>,</span>
<span>  crop <span class="op">=</span> <span class="va">afr_eurasia</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_20k_afr_eurasia</span>,</span>
<span>            main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">climate_20k_afr_eurasia</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-40-1.png" width="576"></p>
<p>Note that outlines that cross the antimeridian are split into
multiple polygons (so that they can be used without projecting the
rasters). For Eurasia, we have the eastern end of Siberia on the left
hand side of the plot. <code>continent_outlines_union</code> provides
the same outlines as single polygons (in case you want to use a
projection).</p>
<p>You can also use your own custom outline (i.e. a polygon, coded as a
<code><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">terra::vect</a></code> object) as a mask to limit the area covered by
the raster. Note that you need to reuse the first vertex as the last
vertex, to close the polygon:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_vec</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="st">"POLYGON ((0 70, 25 70, 50 80, 170 80, 170 10,</span></span>
<span><span class="st">                              119 2.4, 119 0.8, 116 -7.6, 114 -12, 100 -40,</span></span>
<span><span class="st">                              -25 -40, -25 64, 0 70))"</span><span class="op">)</span></span>
<span><span class="va">climate_20k_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span>,</span>
<span>  crop <span class="op">=</span> <span class="va">custom_vec</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_20k_custom</span>, </span>
<span>            main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">climate_20k_custom</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-41-1.png" width="576"></p>
<p><code>region_series</code> takes the same <code>ext</code> and
<code>crop</code> options as <code>region_slice</code> to limit the
extent of the climatic reconstructions.</p>
</div>
<div class="section level2">
<h2 id="working-with-biomes-and-ice-sheets">Working with biomes and ice sheets<a class="anchor" aria-label="anchor" href="#working-with-biomes-and-ice-sheets"></a>
</h2>
<p>The Beyer2020 and Krapp2021 datasets include a categorical variable
detailing the extension of biomes.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_biome_classes.html">get_biome_classes</a></span><span class="op">(</span><span class="st">"Example"</span><span class="op">)</span></span>
<span><span class="co">#&gt;    id                           category</span></span>
<span><span class="co">#&gt; 1   0                       Water bodies</span></span>
<span><span class="co">#&gt; 2   1          Tropical evergreen forest</span></span>
<span><span class="co">#&gt; 3   2     Tropical semi-deciduous forest</span></span>
<span><span class="co">#&gt; 4   3 Tropical deciduous forest/woodland</span></span>
<span><span class="co">#&gt; 5   4         Temperate deciduous forest</span></span>
<span><span class="co">#&gt; 6   5           Temperate conifer forest</span></span>
<span><span class="co">#&gt; 7   6                  Warm mixed forest</span></span>
<span><span class="co">#&gt; 8   7                  Cool mixed forest</span></span>
<span><span class="co">#&gt; 9   8                Cool conifer forest</span></span>
<span><span class="co">#&gt; 10  9                  Cold mixed forest</span></span>
<span><span class="co">#&gt; 11 10      Evegreen taiga/montane forest</span></span>
<span><span class="co">#&gt; 12 11     Deciduous taiga/montane forest</span></span>
<span><span class="co">#&gt; 13 12                   Tropical savanna</span></span>
<span><span class="co">#&gt; 14 13      Tropical xerophytic shrubland</span></span>
<span><span class="co">#&gt; 15 14     Temperate xerophytic shrubland</span></span>
<span><span class="co">#&gt; 16 15     Temperate sclerophyll woodland</span></span>
<span><span class="co">#&gt; 17 16      Temperate broadleaved savanna</span></span>
<span><span class="co">#&gt; 18 17              Open conifer woodland</span></span>
<span><span class="co">#&gt; 19 18                    Boreal parkland</span></span>
<span><span class="co">#&gt; 20 19                 Tropical grassland</span></span>
<span><span class="co">#&gt; 21 20                Temperate grassland</span></span>
<span><span class="co">#&gt; 22 21                             Desert</span></span>
<span><span class="co">#&gt; 23 22                      Steppe tundra</span></span>
<span><span class="co">#&gt; 24 23                       Shrub tundra</span></span>
<span><span class="co">#&gt; 25 24                 Dwarf shrub tundra</span></span>
<span><span class="co">#&gt; 26 25             Prostrate shrub tundra</span></span>
<span><span class="co">#&gt; 27 26    Cushion forb lichen moss tundra</span></span>
<span><span class="co">#&gt; 28 27                             Barren</span></span>
<span><span class="co">#&gt; 29 28                           Land ice</span></span></code></pre></div>
<p>If we need to plot the extent of a specific biome, for example the
desert, we first extract the variable and then subset it to just the
class we are interested in using its ID (21, in this case):</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_20k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"biome"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">climate_20k</span><span class="op">$</span><span class="va">desert</span> <span class="op">&lt;-</span> <span class="va">climate_20k</span><span class="op">$</span><span class="va">biome</span></span>
<span><span class="va">climate_20k</span><span class="op">$</span><span class="va">desert</span><span class="op">[</span><span class="va">climate_20k</span><span class="op">$</span><span class="va">desert</span> <span class="op">!=</span> <span class="fl">21</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span><span class="va">climate_20k</span><span class="op">$</span><span class="va">desert</span><span class="op">[</span><span class="va">climate_20k</span><span class="op">$</span><span class="va">desert</span> <span class="op">==</span> <span class="fl">21</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_20k</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">climate_20k</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-43-1.png" width="576"></p>
<p>The climate reconstructions do not show areas under permanent ice.
Ice sheets are stored as class 28 in the “biome” variable:</p>
<p>To plot it, we use functions designed to get ice and land masks.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_20k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">climate_20k</span><span class="op">$</span><span class="va">ice_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ice_mask.html">get_ice_mask</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20000</span>, dataset <span class="op">=</span> <span class="st">"Example"</span><span class="op">)</span></span>
<span><span class="va">climate_20k</span><span class="op">$</span><span class="va">land_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_land_mask.html">get_land_mask</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20000</span>, dataset <span class="op">=</span> <span class="st">"Example"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_20k</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">climate_20k</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-44-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="set-the-samples-within-the-background">Set the samples within the background<a class="anchor" aria-label="anchor" href="#set-the-samples-within-the-background"></a>
</h2>
<p>In many studies, we want to set the environmental conditions at a
given set of location within the background for that time period. Let us
start by visualising the background for the time step of interest with a
PCA:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bio_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span></span>
<span><span class="va">climate_10k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10000</span>,</span>
<span>  bio_variables <span class="op">=</span> <span class="va">bio_vars</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">climate_values_10k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/df_from_region_slice.html">df_from_region_slice</a></span><span class="op">(</span><span class="va">climate_10k</span><span class="op">)</span></span>
<span><span class="va">climate_10k_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">climate_values_10k</span><span class="op">[</span>, <span class="va">bio_vars</span><span class="op">]</span>, </span>
<span>                          scale <span class="op">=</span> <span class="cn">TRUE</span>, center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_10k_pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">~</span> <span class="va">climate_10k_pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"lightgray"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"PC1"</span>, ylab <span class="op">=</span> <span class="st">"PC2"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-45-1.png" width="384"></p>
<p>We can now get the climatic conditions for the locations at this time
step and compute the PCA scores based on the axes we defined on the
background:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">locations_10k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span>, <span class="fl">20</span>, <span class="fl">5</span><span class="op">)</span>, latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">45</span>, <span class="fl">50</span>, <span class="fl">47</span><span class="op">)</span>,</span>
<span>  time_bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">9932</span>, <span class="op">-</span><span class="fl">9753</span>, <span class="op">-</span><span class="fl">10084</span>, <span class="op">-</span><span class="fl">10249</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">climate_loc_10k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/location_slice.html">location_slice</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">locations_10k</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  time_bp <span class="op">=</span> <span class="va">locations_10k</span><span class="op">$</span><span class="va">time_bp</span>, bio_variables <span class="op">=</span> <span class="va">bio_vars</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">locations_10k_pca_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">climate_10k_pca</span>, </span>
<span>                                    newdata <span class="op">=</span> <span class="va">climate_loc_10k</span><span class="op">[</span>, <span class="va">bio_vars</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>And now we can plot the points on top of the background</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">climate_10k_pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">~</span> <span class="va">climate_10k_pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"lightgray"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"PC1"</span>, ylab <span class="op">=</span> <span class="st">"PC2"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">locations_10k_pca_scores</span>, pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-47-1.png" width="384"></p>
<p>If we want to pool the background from multiple time steps, we can
simple use <code>region_series</code> to get a series, and then
transform it into a data frame with
<code>df_from_region_series</code>.</p>
</div>
<div class="section level2">
<h2 id="random-sampling-of-background">Random sampling of background<a class="anchor" aria-label="anchor" href="#random-sampling-of-background"></a>
</h2>
<p>NOTE: there is a bug in terra 1.6.17 that prevents this section from
working; you will get a “negative probability” error when sampling if
you use that version.</p>
<p>For a number of species distribution models, rather than using the
complete background, we need to subsample background points to our
presences. If we are interested in a single time step, we can simply
generate the raster for the time slice of interest, and use
<code>sample_region_slice</code>:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_20k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="op">-</span><span class="fl">20000</span>,</span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">this_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_region_slice.html">sample_region_slice</a></span><span class="op">(</span><span class="va">climate_20k</span>, size <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">this_sample</span><span class="op">)</span></span>
<span><span class="co">#&gt;    cell     x     y     bio01     bio10</span></span>
<span><span class="co">#&gt; 1 25030   9.5  20.5  21.43332 27.824675</span></span>
<span><span class="co">#&gt; 2 30362 -58.5   5.5  22.59621 24.124298</span></span>
<span><span class="co">#&gt; 3 36130 -50.5 -10.5  21.82633 22.654425</span></span>
<span><span class="co">#&gt; 4 24026  85.5  23.5  21.36464 26.932798</span></span>
<span><span class="co">#&gt; 5  9355 174.5  64.5 -15.37578  5.464261</span></span>
<span><span class="co">#&gt; 6  4277 136.5  78.5 -29.71084  6.500917</span></span></code></pre></div>
<p>We can also sample the background for multiple time steps (e.g. if we
want to match the background to the number of samples based on their
radiocarbon dates). So, for example, if we wanted 3 samples from 20k
years ago and 5 samples from 10k years ago:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climate_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_series.html">region_series</a></span><span class="op">(</span></span>
<span>  time_bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20000</span>,<span class="op">-</span><span class="fl">10000</span><span class="op">)</span>,</span>
<span>  bio_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span>, <span class="st">"bio10"</span>, <span class="st">"bio12"</span><span class="op">)</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Example"</span>,</span>
<span>  ext <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">region_extent</span><span class="op">$</span><span class="va">Europe</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sampled_climate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_region_series.html">sample_region_series</a></span><span class="op">(</span><span class="va">climate_ts</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sampled_climate</span></span>
<span><span class="co">#&gt;          cell    x    y     bio01    bio10    bio12 time_bp</span></span>
<span><span class="co">#&gt; -20000.1 2344 33.5 47.5  2.262170 14.90902 355.6306  -20000</span></span>
<span><span class="co">#&gt; -20000.2 2865 44.5 41.5  4.475834 14.88976 540.7664  -20000</span></span>
<span><span class="co">#&gt; -20000.3 2944 38.5 40.5  4.260213 12.74107 518.1914  -20000</span></span>
<span><span class="co">#&gt; -10000.1 2747 11.5 42.5 13.687679 23.67339 759.1479  -10000</span></span>
<span><span class="co">#&gt; -10000.2 1316 25.5 59.5  3.234554 10.59909 569.0425  -10000</span></span>
<span><span class="co">#&gt; -10000.3 3293 47.5 36.5  7.612511 23.99700 282.1458  -10000</span></span>
<span><span class="co">#&gt; -10000.4 2745  9.5 42.5  9.919656 19.50445 822.4520  -10000</span></span>
<span><span class="co">#&gt; -10000.5 1098 62.5 62.5 -4.120922 15.16186 406.4946  -10000</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="downscaling">Downscaling<a class="anchor" aria-label="anchor" href="#downscaling"></a>
</h2>
<p><code>pastclim</code> does not contain built-in code to change the
spatial resolution of the climatic reconstructions, but it is possible
to downscale the data by using the relevant function from the
<code>terra</code> package.</p>
<p>At first we will need to extract a region and time of choice, in this
case Northern America 10,000 years ago</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Namerica_10k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/region_slice.html">region_slice</a></span><span class="op">(</span>dataset<span class="op">=</span><span class="st">"Example"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01"</span><span class="op">)</span>,</span>
<span>                               time_bp<span class="op">=</span><span class="op">-</span><span class="fl">10000</span>, ext<span class="op">=</span><span class="va">region_extent</span><span class="op">$</span><span class="va">N_America</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Namerica_10k</span><span class="op">)</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-50-1.png" width="576"></p>
<p>We can then downscale using the <code><a href="https://rdrr.io/pkg/terra/man/disaggregate.html" class="external-link">disagg()</a></code> function from
the <code>terra</code> package, requiring an aggregation factor
expressed as number of cells in each direction (horizontally,
vertically, and, if needed, over layers). In the example below we used
25 both horizontally and vertically, using bilinear interpolation.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Namerica_ds</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/disaggregate.html" class="external-link">disagg</a></span><span class="op">(</span><span class="va">Namerica_10k</span>, fact<span class="op">=</span><span class="fl">25</span>, method<span class="op">=</span><span class="st">'bilinear'</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Namerica_ds</span><span class="op">)</span></span></code></pre></div>
<p><img src="a0_pastclim_overview_files/figure-html/unnamed-chunk-51-1.png" width="576"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michela Leonardi, Andrea Manica.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
